# CRM-GTD SaaS Project Setup for Claude Code

## Project Overview
Modern SaaS platform combining CRM, GTD methodology, and SMART goal management with AI-powered automation. Multi-tenant architecture supporting 1,555+ features across web, mobile, and API platforms.

## Tech Stack
- **Backend:** Node.js + TypeScript + Express + PostgreSQL + Redis
- **Frontend:** Next.js 14 + TypeScript + Tailwind CSS + Zustand
- **Mobile:** React Native + TypeScript
- **AI/ML:** Python + FastAPI + TensorFlow + OpenAI API
- **Infrastructure:** Docker + Kubernetes + AWS/Azure
- **Database:** PostgreSQL (main) + Redis (cache) + ClickHouse (analytics)

## Project Structure

```
crm-gtd-saas/
├── packages/
│   ├── backend/                 # Node.js API server
│   │   ├── src/
│   │   │   ├── modules/         # Feature modules
│   │   │   │   ├── auth/        # Authentication & authorization
│   │   │   │   ├── organizations/ # Multi-tenancy
│   │   │   │   ├── users/       # User management
│   │   │   │   ├── streams/     # Stream management (core)
│   │   │   │   ├── tasks/       # GTD tasks
│   │   │   │   ├── projects/    # Project management
│   │   │   │   ├── contacts/    # CRM contacts
│   │   │   │   ├── crm/         # CRM features
│   │   │   │   ├── smart/       # SMART analysis
│   │   │   │   ├── ai/          # AI services integration
│   │   │   │   └── integrations/ # Third-party integrations
│   │   │   ├── shared/          # Shared utilities
│   │   │   │   ├── database/    # DB connection & models
│   │   │   │   ├── middleware/  # Express middleware
│   │   │   │   ├── utils/       # Utility functions
│   │   │   │   └── types/       # TypeScript types
│   │   │   ├── config/          # Configuration
│   │   │   └── app.ts           # Main application
│   │   ├── prisma/              # Database schema & migrations
│   │   ├── tests/               # Backend tests
│   │   └── package.json
│   │
│   ├── frontend/                # Next.js web application
│   │   ├── src/
│   │   │   ├── app/             # Next.js 14 app router
│   │   │   │   ├── (auth)/      # Authentication pages
│   │   │   │   ├── dashboard/   # Main dashboard
│   │   │   │   ├── streams/     # Stream management
│   │   │   │   ├── tasks/       # Task management
│   │   │   │   ├── projects/    # Project management
│   │   │   │   ├── contacts/    # CRM interface
│   │   │   │   ├── analytics/   # Analytics dashboard
│   │   │   │   └── settings/    # Settings & admin
│   │   │   ├── components/      # Reusable components
│   │   │   │   ├── ui/          # Base UI components
│   │   │   │   ├── forms/       # Form components
│   │   │   │   ├── charts/      # Chart components
│   │   │   │   └── layouts/     # Layout components
│   │   │   ├── lib/             # Frontend utilities
│   │   │   │   ├── api/         # API client
│   │   │   │   ├── auth/        # Authentication
│   │   │   │   ├── store/       # State management
│   │   │   │   └── utils/       # Utility functions
│   │   │   └── styles/          # Global styles
│   │   ├── public/              # Static assets
│   │   ├── tests/               # Frontend tests
│   │   └── package.json
│   │
│   ├── mobile/                  # React Native app
│   │   ├── src/
│   │   │   ├── screens/         # App screens
│   │   │   ├── components/      # Mobile components
│   │   │   ├── navigation/      # Navigation setup
│   │   │   ├── services/        # API services
│   │   │   ├── store/           # State management
│   │   │   └── utils/           # Mobile utilities
│   │   ├── ios/                 # iOS specific
│   │   ├── android/             # Android specific
│   │   └── package.json
│   │
│   ├── ai-service/              # Python AI/ML service
│   │   ├── src/
│   │   │   ├── api/             # FastAPI routes
│   │   │   ├── models/          # ML models
│   │   │   ├── services/        # AI services
│   │   │   │   ├── email_analysis/ # Email intelligence
│   │   │   │   ├── smart_analysis/ # SMART goal analysis
│   │   │   │   ├── predictions/    # Predictive analytics
│   │   │   │   └── nlp/            # Natural language processing
│   │   │   ├── utils/           # Python utilities
│   │   │   └── main.py          # FastAPI app
│   │   ├── models/              # Trained ML models
│   │   ├── tests/               # AI service tests
│   │   └── requirements.txt
│   │
│   └── shared/                  # Shared across packages
│       ├── types/               # TypeScript type definitions
│       ├── schemas/             # Database schemas
│       └── constants/           # Shared constants
│
├── infrastructure/              # Infrastructure as Code
│   ├── docker/                  # Docker configurations
│   ├── kubernetes/              # K8s manifests
│   ├── terraform/               # Infrastructure provisioning
│   └── scripts/                 # Deployment scripts
│
├── docs/                        # Documentation
│   ├── api/                     # API documentation
│   ├── architecture/            # System architecture
│   ├── deployment/              # Deployment guides
│   └── user/                    # User documentation
│
├── tools/                       # Development tools
│   ├── scripts/                 # Utility scripts
│   └── generators/              # Code generators
│
├── .github/                     # GitHub workflows
│   └── workflows/               # CI/CD pipelines
│
├── docker-compose.yml           # Development environment
├── package.json                 # Root package.json (workspaces)
├── turbo.json                   # Turborepo configuration
├── README.md                    # Project documentation
└── .env.example                 # Environment variables template
```

## Development Environment Setup

### Prerequisites
```bash
# Required software
node -v    # v18.17.0+
npm -v     # v9.0.0+
docker -v  # v20.0.0+
python -v  # v3.9+
git -v     # v2.30+
```

### Initial Setup Commands
```bash
# 1. Clone and setup project
git clone <repository-url> crm-gtd-saas
cd crm-gtd-saas

# 2. Install dependencies (all packages)
npm install

# 3. Setup environment variables
cp .env.example .env
# Edit .env with your configuration

# 4. Start development services
docker-compose up -d postgres redis clickhouse

# 5. Setup database
cd packages/backend
npx prisma generate
npx prisma db push
npx prisma db seed

# 6. Start all services in development
cd ../..
npm run dev
```

## Environment Variables (.env)

```bash
# Database
DATABASE_URL="postgresql://postgres:password@localhost:5432/crm_gtd_dev"
REDIS_URL="redis://localhost:6379"
CLICKHOUSE_URL="http://localhost:8123"

# Authentication
JWT_SECRET="your-super-secret-jwt-key"
JWT_REFRESH_SECRET="your-refresh-secret-key"
BCRYPT_ROUNDS=12

# Multi-tenancy
DEFAULT_ORG_LIMITS='{"max_users": 10, "max_streams": 5}'

# External APIs
OPENAI_API_KEY="sk-..."
STRIPE_SECRET_KEY="sk_test_..."
STRIPE_WEBHOOK_SECRET="whsec_..."

# Email Services
SMTP_HOST="smtp.gmail.com"
SMTP_PORT=587
SMTP_USER="your-email@gmail.com"
SMTP_PASS="your-app-password"

# File Storage
AWS_ACCESS_KEY_ID="your-aws-key"
AWS_SECRET_ACCESS_KEY="your-aws-secret"
AWS_BUCKET_NAME="crm-gtd-files"
AWS_REGION="us-east-1"

# Monitoring
SENTRY_DSN="https://your-sentry-dsn"
LOG_LEVEL="debug"

# Frontend
NEXT_PUBLIC_API_URL="http://localhost:3001"
NEXT_PUBLIC_APP_URL="http://localhost:3000"
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY="pk_test_..."

# AI Service
AI_SERVICE_URL="http://localhost:8000"
PYTHON_API_KEY="your-python-api-key"
```

## Key Features to Implement (Phase 1 MVP)

### 1. Multi-tenant Architecture (CRITICAL)
```typescript
// packages/backend/src/shared/middleware/tenancy.ts
export const tenancyMiddleware = (req: Request, res: Response, next: NextFunction) => {
  const orgId = req.user?.organizationId;
  if (!orgId) return res.status(401).json({ error: 'Organization required' });
  req.organization = { id: orgId };
  next();
};
```

### 2. Authentication & Authorization
- JWT-based auth with refresh tokens
- Role-based access control (RBAC)
- Organization-level permissions
- SSO integration (future)

### 3. Core GTD System
- Tasks with contexts and priorities
- Projects with milestones
- Areas of responsibility
- Weekly review system
- Waiting for tracking

### 4. Stream Management (Core Differentiator)
- Flexible stream creation and management
- Cross-stream relationships
- Resource allocation per stream
- Stream templates for different industries

### 5. Basic CRM
- Contact management
- Lead tracking
- Simple sales pipeline
- Meeting scheduling
- Basic invoicing

### 6. SMART Goal Analysis
- Automated SMART score calculation
- Goal improvement suggestions
- Progress tracking
- Achievement analytics

### 7. Real-time Collaboration
- WebSocket connections
- Live updates
- Collaborative editing
- Team notifications

### 8. Mobile App Foundation
- React Native setup
- Offline-first architecture
- Push notifications
- Core feature parity

## Development Guidelines

### Code Standards
```typescript
// Use TypeScript strict mode
// Follow ESLint + Prettier configuration
// Write tests for all business logic
// Document complex functions with JSDoc
// Use conventional commits

// Example: Task creation service
export class TaskService {
  /**
   * Creates a new task within an organization
   * @param orgId - Organization ID for multi-tenancy
   * @param taskData - Task creation data
   * @returns Created task with SMART analysis
   */
  async createTask(orgId: string, taskData: CreateTaskDto): Promise<TaskWithSmart> {
    // Implementation with proper error handling
  }
}
```

### Database Design Principles
```sql
-- Multi-tenancy: Every table has organization_id
-- Row Level Security (RLS) for data isolation
-- Proper indexing for performance
-- Foreign key constraints for data integrity

CREATE TABLE tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    organization_id UUID NOT NULL REFERENCES organizations(id),
    stream_id UUID REFERENCES streams(id),
    title TEXT NOT NULL,
    description TEXT,
    status task_status DEFAULT 'new',
    priority task_priority DEFAULT 'medium',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- RLS Policy
CREATE POLICY tasks_org_isolation ON tasks
FOR ALL TO authenticated
USING (organization_id = current_setting('app.current_org_id')::uuid);
```

### API Design Standards
```typescript
// RESTful API with consistent patterns
// Proper HTTP status codes
// Request/response validation
// Error handling middleware
// Rate limiting per organization

// Example: Task API routes
router.get('/tasks', tenancyMiddleware, getTasks);        // GET /api/tasks
router.post('/tasks', tenancyMiddleware, createTask);     // POST /api/tasks
router.get('/tasks/:id', tenancyMiddleware, getTask);     // GET /api/tasks/123
router.put('/tasks/:id', tenancyMiddleware, updateTask);  // PUT /api/tasks/123
router.delete('/tasks/:id', tenancyMiddleware, deleteTask); // DELETE /api/tasks/123
```

## Testing Strategy

### Backend Testing
```bash
# Unit tests
npm run test:unit

# Integration tests
npm run test:integration

# E2E tests
npm run test:e2e

# Coverage report
npm run test:coverage
```

### Frontend Testing
```bash
# Component tests
npm run test:components

# E2E tests with Playwright
npm run test:e2e:web

# Visual regression tests
npm run test:visual
```

## Deployment Pipeline

### Development Workflow
```bash
# 1. Feature branch
git checkout -b feature/stream-management

# 2. Development with hot reload
npm run dev

# 3. Testing
npm run test

# 4. Code review
git push origin feature/stream-management
# Create PR in GitHub

# 5. Automated CI/CD
# - Tests run automatically
# - Deploy to staging on PR merge
# - Deploy to production on main branch
```

### Docker Development
```bash
# Build all services
docker-compose build

# Start development environment
docker-compose up

# View logs
docker-compose logs -f backend

# Execute commands in container
docker-compose exec backend npm run db:migrate
```

## Monitoring & Observability

### Logging
```typescript
// Structured logging with Winston
import { logger } from '@/shared/utils/logger';

logger.info('Task created', {
  taskId: task.id,
  organizationId: task.organizationId,
  userId: req.user.id,
  duration: Date.now() - startTime
});
```

### Metrics
```typescript
// Custom metrics for SaaS
export const metrics = {
  taskCreated: new Counter('tasks_created_total'),
  apiDuration: new Histogram('api_duration_seconds'),
  activeUsers: new Gauge('active_users_total')
};
```

## Security Considerations

### Data Protection
- All sensitive data encrypted at rest
- PII handling with proper anonymization
- GDPR compliance built-in
- Regular security audits

### API Security
- Rate limiting per organization
- Input validation and sanitization
- SQL injection prevention
- XSS protection headers

## Performance Optimization

### Database Performance
- Proper indexing strategy
- Query optimization
- Connection pooling
- Read replicas for scaling

### Frontend Performance
- Code splitting by route
- Image optimization
- Lazy loading components
- Service worker for caching

## Next Steps for Claude Code

1. **Start with backend setup** - Authentication and multi-tenancy
2. **Implement core GTD models** - Tasks, Projects, Streams
3. **Build API endpoints** - RESTful services with proper validation
4. **Create frontend foundation** - Next.js setup with authentication
5. **Add real-time features** - WebSocket implementation
6. **Implement SMART analysis** - Goal evaluation algorithms
7. **Mobile app development** - React Native with offline support
8. **AI service integration** - Email analysis and predictions

## Claude Code Commands to Get Started

```bash
# Initialize the project structure
claude-code init --template="saas-multi-tenant" --name="crm-gtd-saas"

# Generate authentication module
claude-code generate module auth --features="jwt,rbac,multi-tenant"

# Generate database schema
claude-code generate schema --from="./docs/database-schema.sql"

# Generate API endpoints
claude-code generate api --module="tasks" --crud --validation

# Generate frontend components
claude-code generate components --module="tasks" --ui-library="tailwind"

# Setup testing framework
claude-code setup testing --backend="jest" --frontend="playwright"

# Setup CI/CD pipeline
claude-code setup cicd --platform="github" --deployment="docker"
```

This setup provides a solid foundation for building the CRM-GTD SaaS platform with Claude Code. The project structure is designed for scalability, maintainability, and rapid development while following SaaS best practices.