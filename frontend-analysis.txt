=== ANALIZA BRAKUJĄCYCH PLIKÓW FRONTEND ===
Data: Thu Jan 29 10:04:14 PM UTC 2026

=== PLIKI ŹRÓDŁOWE ===
Liczba plików .tsx w src/app:
271

Liczba plików page.tsx:
263

Liczba plików layout.tsx:
4
 echo === PLIKI W KONTENERZE DOCKER === echo Liczba plików page.js w .next/server/app: docker exec crm-frontend find /app/.next/server/app -name page.js
 13 /tmp/frontend-analysis.txt
 13 total

=== PLIKI W KONTENERZE DOCKER ===
Liczba plików page.js w .next/server/app:
262

Liczba plików layout.js w .next/server/app:
0
=== BRAKUJĄCE STRONY (w źródłach ale nie w Docker) ===
dashboard/_ai-management
[locale]/dashboard/_ai-management

=== DODATKOWE STRONY (w Docker ale nie w źródłach) ===
_not-found

=== ANALIZA LOKALIZACJI (i18n) ===

Pliki tłumaczeń w źródłach:
total 172
drwxr-xr-x  2 dev  dev    4096 Jan 29 20:49 .
drwxrwxrwx 12 dev  dev    4096 Jan 29 10:56 ..
-rw-r--r--  1 root root 135427 Jan 29 08:00 de.json
-rw-r--r--  1 root root   9415 Jan 29 20:49 en.json
-rw-------  1 dev  dev     297 Jan 26 12:09 languages.json
-rw-r--r--  1 root root  10051 Jan 29 20:49 pl.json

Pliki tłumaczeń w kontenerze:
Brak katalogu messages

next.config.js - konfiguracja locale:

=== PROBLEM: BRAKUJĄCY KATALOG messages ===
Katalog messages/ nie jest kopiowany do standalone output!

=== DOCKERFILE ===
# Frontend Dockerfile
FROM node:18-alpine AS base

# Install dependencies only when needed
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app

# Copy package files
COPY package*.json ./
RUN npm install

# Rebuild the source code only when needed
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

# Build the application
RUN npm run build

# Production image, copy all the files and run next
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# Copy built application
COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD wget --no-verbose --tries=1 --spider http://localhost:3000/health || exit 1

CMD ["node", "server.js"]

=== next.config.js ===
/** @type {import('next').NextConfig} */
const createNextIntlPlugin = require('next-intl/plugin');

const withNextIntl = createNextIntlPlugin('./src/i18n/request.ts');

// Determine basePath based on version
const isV2 = process.env.NEXT_PUBLIC_APP_VERSION === '2.0.0-dev';
const isV1 = process.env.NEXT_PUBLIC_APP_VERSION === '1.0.0';

console.log('Next.js Config Loading:', {
  NEXT_PUBLIC_APP_VERSION: process.env.NEXT_PUBLIC_APP_VERSION,
  isV1,
  isV2,
  message: 'No basePath - using nginx routing with assetPrefix only'
});

const nextConfig = {
  // Standalone output for Docker production builds
  output: 'standalone',

  // CRM System - basePath i assetPrefix dla plików statycznych
  basePath: '/crm',
  assetPrefix: '/crm',
  
  // Wyłącz trailingSlash dla lepszego routingu
  trailingSlash: false,
  skipTrailingSlashRedirect: true,
  
  // Ignore ESLint errors during build
  eslint: {
    ignoreDuringBuilds: true,
  },
  
  // Skip type checking during build to speed up
  typescript: {
    ignoreBuildErrors: true,
  },

  // Disable webpack filesystem cache to avoid ENOSPC errors
  webpack: (config, { isServer }) => {
    config.cache = {
      type: 'memory',
    };
    return config;
  },

};

module.exports = withNextIntl(nextConfig);
=== DIAGNOZA ===

PROBLEM 1: Brak katalogu messages/ w kontenerze Docker
  - Dockerfile nie kopiuje messages/ do stage 'runner'
  - Tłumaczenia (pl.json, en.json, de.json) są niedostępne
  - To powoduje błędy 404 lub brak tłumaczeń

PROBLEM 2: Standalone output Next.js nie zawiera external files
  - next.config.js używa output: 'standalone'
  - Standalone nie zawiera automatycznie: messages/, public/ (częściowo)

=== ROZWIĄZANIE ===
Dodać do Dockerfile (stage runner):
  COPY --from=builder /app/messages ./messages

=== INNE POTENCJALNIE BRAKUJĄCE PLIKI ===

Katalog public/ w źródłach:
manifest.json
voice-response-engine

Katalog public/ w kontenerze:
manifest.json
voice-response-engine

Katalog src/i18n w źródłach:
request.ts
routing.ts
